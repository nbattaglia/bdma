Iteracion 1
Feature: Registro y autenticación de investigadores
  Como Investigador
  Quiero registrarme y autenticarme
  Para gestionar mis envíos y revisiones

  @registro-exitoso
  Scenario: Registro exitoso con ORCID y verificación de email
    Given existe el proveedor de identidad "ORCID"
    And no existe una cuenta previa con email "ana@uni.edu"
    When el Investigador se registra con ORCID válido y email "ana@uni.edu"
    And confirma el email recibido
    Then la cuenta "ana@uni.edu" queda en estado "Activa"
    And el perfil se crea con ORCID vinculado

  @autenticacion-ok
  Scenario: Autenticación exitosa con credenciales válidas
    Given existe la cuenta "ana@uni.edu" en estado "Activa" con password "s3cret!"
    When intenta autenticarse con email "ana@uni.edu" y password "s3cret!"
    Then el acceso es concedido
    And se registra auditoría de inicio de sesión

  @autenticacion-falla
  Scenario: Autenticación rechazada por contraseña incorrecta
    Given existe la cuenta "ana@uni.edu" en estado "Activa" con password "s3cret!"
    When intenta autenticarse con email "ana@uni.edu" y password "wrong"
    Then el acceso es denegado por credenciales inválidas

  @bloqueo
  Scenario: Bloqueo por múltiples intentos fallidos
    Given existe la cuenta "mike@uni.edu" en estado "Activa" con password "pass"
    When intenta autenticarse 5 veces con password incorrecto
    Then la cuenta "mike@uni.edu" queda en estado "Bloqueada"
    And se notifica al usuario por email

Feature: Gestión de perfil de investigador
  Como Investigador
  Quiero mantener mi perfil con afiliación, áreas y métricas
  Para facilitar asignaciones y reportes

  @perfil-basico
  Scenario: Completar afiliación y áreas de interés
    Given el Investigador "Ana" tiene un perfil inicial sin afiliación ni áreas
    When actualiza afiliación a "Universidad X" y áreas ["IA", "NLP"]
    Then el perfil de "Ana" muestra afiliación "Universidad X" y áreas ["IA", "NLP"]

  @sincronizacion-metricas
  Scenario: Importar métricas desde ORCID/Google Scholar
    Given el perfil "Ana" tiene ORCID vinculado
    When sincroniza métricas de citaciones e índice-h desde "Google Scholar"
    Then el perfil exhibe métricas actualizadas con fuente "Google Scholar" y fecha de actualización

Feature: Envío y versionado de artículos
  Como Autor
  Quiero enviar y versionar artículos
  Para postular a revistas y conferencias respetando deadlines

  @envio-evento
  Scenario: Envío válido a evento antes del deadline
    Given existe el Evento "IC-2026" con fecha límite de envío "2026-05-01"
    And soy Autor con perfil completo
    When envío el Artículo "A-101" a "IC-2026" en fecha "2026-04-20"
    Then se registra el Envío "E-1" en estado "Enviado" con versión 1
    And recibo comprobante de envío con sello de tiempo

  @envio-revista
  Scenario: Envío válido a revista con revisión doble ciego
    Given existe la Revista "SJ-ML" con tipo de revisión "Doble ciego"
    And soy Autor con perfil completo
    When envío el Artículo "A-202" a "SJ-ML" en fecha "2026-03-10"
    Then se registra el Envío "E-2" en estado "Enviado" con versión 1
    And se verifica que el archivo no contenga datos identificatorios

  @deadline
  Scenario: Rechazo por envío fuera de fecha
    Given existe el Evento "IC-2026" con fecha límite de envío "2026-05-01"
    And soy Autor con perfil completo
    When envío el Artículo "A-102" a "IC-2026" en fecha "2026-05-10"
    Then el sistema rechaza el envío por deadline excedido con motivo "Fecha límite superada"

  @versionado
  Scenario: Nuevo versionado de un envío en curso
    Given existe el Envío "E-1" del Artículo "A-101" en estado "Enviado" y versión 1
    When adjunto una nueva versión con cambios menores
    Then el Envío "E-1" queda en versión 2
    And el historial conserva versiones [1, 2]

Feature: Registro de revisores y especialidades
  Como Revisor
  Quiero registrar mis especialidades y conflictos
  Para recibir asignaciones apropiadas

  @alta-revisor
  Scenario: Registro de revisor con especialidades
    Given no existe el Revisor "r1"
    When registro al Revisor "r1" con especialidades ["IA", "NLP"]
    Then el Revisor "r1" queda "Activo" con especialidades ["IA", "NLP"]

  @conflictos
  Scenario: Declaración de conflicto de interés
    Given el Revisor "r1" está "Activo"
    When declara conflicto con el Autor "Ana" por coautoría reciente
    Then el conflicto queda registrado y bloquea asignaciones con "Ana" por 2 años

Feature: Asignación de revisores y manejo de ceguera
  Como Editor
  Quiero asignar revisores automáticamente o manualmente
  Para iniciar la evaluación cumpliendo reglas y anonimato

  @auto-assign
  Scenario: Asignación automática según especialidad y conflictos
    Given existe el Envío "E-1" con tema "NLP"
    And candidatos Revisores ["r1:IA", "r2:SE", "r3:NLP", "r4:IA"]
    And el Revisor "r2" tiene conflicto con el Autor de "E-1"
    And las reglas editoriales exigen "3" revisores
    When ejecuto la asignación automática para "E-1"
    Then quedan asignados 3 revisores especialistas sin conflictos
    And el Autor no ve las identidades de los revisores
    And los Revisores no ven la identidad ni afiliación del Autor

  @manual-assign
  Scenario: Asignación manual con validación de conflictos
    Given existe el Envío "E-1" pendiente de asignación
    And el Editor selecciona "r2", "r3" y "r4"
    When confirma la asignación manual
    Then el sistema impide asignar "r2" por conflicto registrado
    And propone candidatos alternativos compatibles

  @ceguera-simple
  Scenario: Aplicación de ceguera simple en revista configurada
    Given la Revista "SJ-DS" tiene tipo de revisión "Ciego simple"
    And existe el Envío "E-3" a "SJ-DS"
    When asigno revisores para "E-3"
    Then los Revisores no ven la identidad del Autor
    And el Autor puede ver las identidades de los Revisores solo después de la decisión final

Feature: Ciclo de revisión por pares
  Como Revisor
  Quiero aceptar/declinar invitaciones y cargar evaluaciones
  Para contribuir a la decisión editorial

  @aceptacion
  Scenario: Revisor acepta invitación
    Given el Revisor "r3" fue invitado a revisar el Envío "E-1"
    When "r3" acepta la invitación dentro de 3 días
    Then la asignación de "r3" pasa a estado "Aceptada"
    And se habilita el formulario de revisión

  @declinacion
  Scenario: Revisor declina por conflicto sobrevenido
    Given el Revisor "r3" fue invitado a revisar el Envío "E-1"
    When "r3" declara conflicto y declina la invitación
    Then su asignación pasa a "Declinada"
    And se notifica al Editor para reasignación

  @entrega
  Scenario: Entrega de revisión con recomendación
    Given el Revisor "r3" tiene asignación "Aceptada" sobre "E-1"
    When envía su revisión con recomendación "Mayor revisión"
    Then la revisión queda registrada con sello de tiempo y versión
    And el historial del Envío "E-1" muestra la revisión de "r3"

  @historial
  Scenario: Consulta del historial completo de revisiones por artículo
    Given existen revisiones de "r1", "r3" y "r4" para el Envío "E-1"
    When consulto el historial de revisiones de "E-1"
    Then veo todas las revisiones con autores anónimos, fechas y recomendaciones

Feature: Gestión editorial y de conferencias
  Como Administrador Editorial
  Quiero dar de alta venues y configurar reglas
  Para adaptar el proceso sin afectar envíos en curso

  @alta-revista
  Scenario: Alta de nueva revista con reglas iniciales
    Given no existe la Revista "SJ-DS"
    When doy de alta la Revista "SJ-DS" con reglas {revisoresMin:2, ceguera:"Ciego simple", fechas:{envio:"2026-03-01"}}
    Then la Revista "SJ-DS" queda "Activa" con reglas publicadas en versión "v1"

  @alta-evento
  Scenario: Alta de nuevo evento con fechas clave
    Given no existe el Evento "IC-2027"
    When doy de alta el Evento "IC-2027" con fechas {envio:"2027-04-01", notificacion:"2027-06-15"}
    Then el Evento "IC-2027" queda "Activo" con sus fechas configuradas

  @versionado-reglas
  Scenario: Cambio de reglas no afecta envíos en curso
    Given la Revista "SJ-DS" tiene reglas versión "v1" y envíos en curso bajo "v1"
    When publico reglas versión "v2" cambiando revisoresMin a 3
    Then los nuevos envíos usan "v2"
    And los envíos en curso continúan con "v1"

  @roles-editoriales
  Scenario: Administración de editores y comité científico
    Given existe la Revista "SJ-ML"
    And no existen editores asignados
    When agrego al Editor "ed1" y al Comité ["c1","c2"]
    Then "ed1" queda con rol "Editor" y ["c1","c2"] con rol "Comité"
    And las acciones de asignación quedan auditadas

Feature: Decisión editorial y comunicaciones
  Como Editor
  Quiero emitir decisiones y cartas
  Para cerrar el proceso conforme a reglas

  @decision
  Scenario: Emisión de decisión basada en reglas y quorum
    Given el Envío "E-1" tiene 3 revisiones con recomendaciones ["Aceptación", "Mayor revisión", "Aceptación"]
    And las reglas exigen minRevisiones=3, quorum="2 de 3", umbral=">=Aceptación"
    When calculo la decisión editorial para "E-1"
    Then la decisión es "Aceptado condicional"
    And se genera carta de decisión con condiciones y plantilla aprobada

  @aceptacion-final
  Scenario: Emisión de certificado tras aceptación final
    Given el Envío "E-1" está en estado "Aceptado"
    And el Autor subió la versión final y transfirió copyright
    When cierro el expediente editorial
    Then se emite certificado de aceptación para el Autor
    And se programa la publicación con fecha estimada

Feature: Gestión de métricas e informes
  Como Analista
  Quiero generar métricas y exportarlas
  Para seguimiento por autor, artículo, evento y revista

  @metricas-autor
  Scenario: Métricas por autor y evento
    Given existen envíos y decisiones históricas
    When genero métricas para el Autor "Ana" en el Evento "IC-2026"
    Then obtengo métricas {envios:2, aceptados:1, tasaAceptacion:"50%"} con periodo consultado

  @metricas-revista
  Scenario: Métricas por revista
    Given existen decisiones en la Revista "SJ-ML" durante 2026
    When genero el informe de tasa de aceptación mensual para "SJ-ML"
    Then obtengo una serie temporal con aceptación, tiempos de revisión y desviación estándar

  @export
  Scenario Outline: Exportación de reportes a formatos estándar
    Given existe un reporte consolidado "R-1"
    When exporto el reporte "R-1" en formato "<formato>"
    Then descargo un archivo con extensión "<extension>" y esquema válido

    Examples:
      | formato | extension |
      | CSV     | .csv      |
      | JSON-LD | .jsonld   |
      | XML     | .xml      |

  @boletin
  Scenario: Envío de notificación mensual personalizada
    Given el Autor "Ana" está suscripto al resumen mensual
    And existen métricas del último mes para "Ana"
    When corre el job mensual
    Then se envía un email a "Ana" con su resumen y enlaces a detalles

Feature: Integraciones externas y validación de metadatos
  Como Sistema
  Quiero sincronizar perfiles y validar metadatos
  Para mantener calidad e interoperabilidad

  @orcid
  Scenario: Sincronización de datos de perfil desde ORCID
    Given el perfil "Ana" tiene ORCID vinculado
    And existen cambios en ORCID para nombre y afiliación
    When sincronizo datos desde ORCID
    Then el perfil se actualiza preservando cambios locales confirmados
    And se registra la fuente y fecha de sincronización

  @scopus-scholar
  Scenario: Importación de publicaciones desde Scopus y Google Scholar
    Given el perfil "Ana" tiene identificadores válidos en Scopus y Google Scholar
    When importo sus publicaciones recientes
    Then las nuevas publicaciones se agregan como referencias con deduplicación por DOI

  @doi
  Scenario: Validación de DOI y metadatos al registrar versión final
    Given el Envío "E-1" está en versión final con DOI "10.1000/xyz123"
    And los metadatos requeridos son {titulo, autores, afiliaciones, resumen, palabrasClave}
    When valido el DOI y los metadatos
    Then el DOI queda marcado "Válido" y los metadatos "Completos"
    And el registro queda listo para indexación
